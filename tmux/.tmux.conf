# -------------------------------
# TMUX
# -------------------------------

# remap prefix
unbind C-b
set -g prefix C-a
bind-key C-a send-prefix

set -g base-index 1           # window start at 1
setw -g pane-base-index 1     # pane start at 1

# mouse
set -g mouse on

# ####
# CLIPBOARD
setw -g mode-keys vi
bind v copy-mode
set -g set-clipboard on   # Bật đồng bộ clipboard, tmux tự động sync với clipboard hệ thống.
## clipboard on X11_unix
# set -g @clipboard_copy 'xsel -i -b'
# set -g @clipboard_paste 'xsel -o -b'
## clipboard on Wayland
# if-shell 'command -v wl-copy >/dev/null' {
#   set -g @clipboard_copy 'wl-copy'
#   set -g @clipboard_paste 'wl-paste'
# }
## clipboard on macOS
# if-shell 'command -v pbcopy >/dev/null' {
#   set -g @clipboard_copy 'pbcopy'
#   set -g @clipboard_paste 'pbpaste'
# }
# bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel \;\
#   run-shell "tmux save-buffer - | #{@clipboard_copy}"
# bind p run-shell "#{@clipboard_paste} | tmux load-buffer - && tmux paste-buffer"

bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind p paste-buffer
bind C-p paste-buffer
# bind -n C-M-p paste-buffer
# bind -n C-M-P paste-buffer

# reload
bind R source-file ~/.tmux.conf \; display "Tmux's Config Reloaded!"

# command-prompt
unbind :
unbind \;
bind \; command-prompt
bind c-\; command-prompt

# maximize
bind -n M-m resize-pane -Z

# disable confirm on kill windows / kill pane
bind & kill-window
bind x kill-pane
bind C-x kill-pane
bind -n C-M-x kill-pane

set -sg escape-time 0
set -g status-interval 0

# split panes using \ and -
# unbind '"'
# unbind %
bind - split-window
bind -n  C-M-_ split-window
bind \\ split-window -h
bind -n C-M-\\ split-window -h


# bind -n C-M-n next-window
# bind -n C-M-p prev
# Next window (C-M-n), no wrap-around
bind -n C-M-n run-shell '\
  is_end=$(tmux display-message -p "#{?window_end_flag,1,0}"); \
  if [ "$is_end" -eq 0 ]; then \
    tmux next-window; \
  fi'

# Previous window (C-M-p), no wrap-around
bind -n C-M-p run-shell '\
  is_start=$(tmux display-message -p "#{?window_start_flag,1,0}"); \
  if [ "$is_start" -eq 0 ]; then \
    tmux previous-window; \
  fi'

# switch panes using Alt-arrow without prefix(-n flag)
# bind -n M-Left select-pane -L
# bind -n M-Right select-pane -R
# bind -n M-Up select-pane -U
# bind -n M-Down select-pane -D

# bind -n M-h select-pane -L
# bind -n M-l select-pane -R
# bind -n M-k select-pane -U
# bind -n M-j select-pane -D

# bind -n C-M-h select-pane -L
# bind -n C-M-l select-pane -R
# bind -n C-M-k select-pane -U
# bind -n C-M-j select-pane -D

# Select pane left, no wrap-around
bind -n C-M-h run-shell '\
  pane_left=$(tmux display -p "#{?pane_at_left,1,0}"); \
  if test "$pane_left" -eq 0; then \
    tmux select-pane -L; \
  fi'

# Select pane right, no wrap-around
bind -n C-M-l run-shell '\
  pane_right=$(tmux display -p "#{?pane_at_right,1,0}"); \
  if test "$pane_right" -eq 0; then \
    tmux select-pane -R; \
  fi'

# Select pane up, no wrap-around
bind -n C-M-k run-shell '\
  pane_top=$(tmux display -p "#{?pane_at_top,1,0}"); \
  if test "$pane_top" -eq 0; then \
    tmux select-pane -U; \
  fi'

# Select pane down, no wrap-around
bind -n C-M-j run-shell '\
  pane_bottom=$(tmux display -p "#{?pane_at_bottom,1,0}"); \
  if test "$pane_bottom" -eq 0; then \
    tmux select-pane -D; \
  fi'

# resize
bind -r H resize-pane -L 5
bind -r L resize-pane -R 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5




# -------------------------------
# tmux-plugin-manager
# -------------------------------
## Auto install tpm at first-run
if "test ! -d ~/.tmux/plugins/tpm" \
  "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"
## Tmux plugin manager
### Prefix + [Shift_I] : Install plugin
### Prefix + [Shift_u] : uninstall plugin
### Prefix + [Shift_U] : Update plugins
###       Prefix [Shift_U] [Enter] > all [Enter] : update all plugin
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'

set -g @plugin 'tmux-plugins/tmux-resurrect'   # session. Prefix_Ctrl_S > Save session. Prefix_Ctrl_R > Load session.
set -g @plugin 'tmux-plugins/tmux-continuum'   # session auto save

set -g @plugin 'tmux-plugins/tmux-yank'        # clipboard


# tmux-plugin-manager: Start TPM
run '~/.tmux/plugins/tpm/tpm'
